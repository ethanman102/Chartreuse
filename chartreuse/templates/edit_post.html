<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Post</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-light">
    <br></br>
    <br></br>
    <div class="container vh-100 d-flex justify-content-center align-items-center">
        <div class="text-center">
            <h1 class="mb-4">Edit post</h1>
            <form method="POST" action="/chartreuse/homepage/post/{{ post.url_id }}/update/" enctype="multipart/form-data">
                {% csrf_token %}
                
            <label for="title" class="form-label">Post Title</label>
            <input type="text" class="form-control" id="title" name="title" required value="{{ post.title }}">

            <label for="description" class="form-label">Post Description</label>
            <input type="text" class="form-control" id="description" name="description" required value="{{ post.description }}">

            <label class="form-label mt-3">Choose Content Type</label>
            <div class="d-flex justify-content-center mb-3">
                {% if post.contentType == "text/plain" %}
                    <div class="form-check me-3">
                        <input class="form-check-input" type="radio" name="content_type" id="textOption" value="text" checked>
                        <label class="form-check-label" for="textOption">Text</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="content_type" id="imageOption" value="image">
                        <label class="form-check-label" for="imageOption">Image</label>
                    </div>
                {% else %}
                    <div class="form-check me-3">
                        <input class="form-check-input" type="radio" name="content_type" id="textOption" value="text">
                        <label class="form-check-label" for="textOption">Text</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="content_type" id="imageOption" value="image" checked>
                        <label class="form-check-label" for="imageOption">Image</label>
                    </div>
                {% endif %}
            </div>

            {% if post.contentType == "text/plain" %}
                <div id="textContent">
                    <label for="content" class="form-label">Content</label>
                    <textarea class="form-control" id="content" name="content" rows="5">{{ post.content }}</textarea>
                </div>

                <div id="imageContent" class="hidden">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="image_type" id="uploadImageOption" value="upload" checked>
                        <label class="form-check-label" for="uploadImageOption">Upload Image</label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="image_type" id="urlImageOption" value="url">
                        <label class="form-check-label" for="urlImageOption">Provide Image URL</label>
                    </div>

                    <div id="uploadImageContent">
                        <label for="image" class="form-label">Upload Image</label>
                        <input type="file" class="form-control" id="image" name="image">
                    </div>

                    <div id="urlImageContent" class="hidden">
                        <label for="image_url" class="form-label">Image URL</label>
                        <input type="url" class="form-control" id="image_url" name="image_url" placeholder="Enter image URL">
                    </div>
                </div>
            {% else %}
                <div id="textContent" class="hidden">
                    <label for="content" class="hidden">Content</label>
                    <textarea class="form-control" id="content" name="content" rows="5" required></textarea>
                </div>

                <div id="imageContent">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="image_type" id="uploadImageOption" value="upload" checked>
                        <label class="form-check-label" for="uploadImageOption">Upload Image</label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="image_type" id="urlImageOption" value="url">
                        <label class="form-check-label" for="urlImageOption">Provide Image URL</label>
                    </div>

                    <div id="uploadImageContent">
                        <label for="image" class="form-label">Upload Image</label>
                        <input type="file" class="form-control" id="image" name="image">
                    </div>

                    <div id="urlImageContent">
                        <label for="image_url" class="form-label">Image URL</label>
                        <input type="url" class="form-control" id="image_url" name="image_url" placeholder="Enter image URL">
                    </div>
                </div>
            {% endif %}

            <!-- Visibility Dropdown -->
            <label for="visibility" class="form-label mt-3">Visibility</label>
            <select class="form-select" id="visibility" name="visibility">
                <option value="PUBLIC" {% if post.visibility == "PUBLIC" %}selected{% endif %}>Public</option>
                <option value="PRIVATE" {% if post.visibility == "PRIVATE" %}selected{% endif %}>Private</option>
                <option value="FRIENDS" {% if post.visibility == "FRIENDS" %}selected{% endif %}>Friends Only</option>
            </select>

            <div class="d-flex gap-2 mt-3">
                <button type="submit" class="btn btn-primary">Update Post</button>
                <a href="javascript:history.back()" class="btn btn-secondary">Cancel</a>
            </div>
            
                <br></br>
            </form>
        </div>
    </div>

    <script>
        const textOption = document.getElementById('textOption');
        const imageOption = document.getElementById('imageOption');
        const textContent = document.getElementById('textContent');
        const imageContent = document.getElementById('imageContent');
        const uploadImageOption = document.getElementById('uploadImageOption');
        const urlImageOption = document.getElementById('urlImageOption');
        const uploadImageContent = document.getElementById('uploadImageContent');
        const urlImageContent = document.getElementById('urlImageContent');
        const textArea = document.getElementById('content');
        const imageInput = document.getElementById('image');
        const imageUrlInput = document.getElementById('image_url');
    
        textOption.addEventListener('change', function() {
            if (textOption.checked) {
                textContent.classList.remove('hidden');
                imageContent.classList.add('hidden');
                textArea.required = true;
                imageInput.required = false;
                imageUrlInput.required = false;
                imageInput.value = '';
                imageUrlInput.value = '';
            }
        });
    
        imageOption.addEventListener('change', function() {
            if (imageOption.checked) {
                imageContent.classList.remove('hidden');
                textContent.classList.add('hidden');
                textArea.required = false;
                textArea.value = '';
                if (uploadImageOption.checked) {
                    imageInput.required = true;
                    imageUrlInput.required = false;
                } else {
                    imageInput.required = false;
                    imageUrlInput.required = true;
                }
            }
        });
    
        uploadImageOption.addEventListener('change', function() {
            if (uploadImageOption.checked) {
                uploadImageContent.classList.remove('hidden');
                urlImageContent.classList.add('hidden');
                imageInput.required = true;
                imageUrlInput.required = false;
                imageUrlInput.value = '';
            }
        });
    
        urlImageOption.addEventListener('change', function() {
            if (urlImageOption.checked) {
                urlImageContent.classList.remove('hidden');
                uploadImageContent.classList.add('hidden');
                imageInput.required = false;
                imageUrlInput.required = true;
                imageInput.value = '';
            }
        });
    </script>    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
